func TestCreateField(t *testing.T) {
	setupTestDB()
	defer teardownTestDB()

	// Insert test data
	dbResult, _ := metaDB.Exec("INSERT INTO databases (name, description, workspace_id) VALUES (?, ?, ?)", "TestDB", "Test database", 1)
	databaseID, _ := dbResult.LastInsertId()
	tableResult, _ := metaDB.Exec("INSERT INTO tables (name, database_id) VALUES (?, ?)", "TestTable", databaseID)
	tableID, _ := tableResult.LastInsertId()

	router := mux.NewRouter()
	router.HandleFunc("/fields", createField).Methods("POST")

	payload := []byte(fmt.Sprintf(`{"name":"TestField","type":"TEXT","table_id":%d}`, tableID))
	req, _ := http.NewRequest("POST", "/fields", bytes.NewBuffer(payload))
	rr := httptest.NewRecorder()

	router.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Errorf("handler returned wrong status code: got %v want %v", status, http.StatusOK)
	}

	var response Field
	json.Unmarshal(rr.Body.Bytes(), &response)

	if response.Name != "TestField" {
		t.Errorf("handler returned unexpected body: got %v want %v", response.Name, "TestField")
	}
}
